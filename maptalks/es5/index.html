<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>地图 - 显示</title>
<style type="text/css">
    html,
    body {
        margin: 0px;
        height: 100%;
        width: 100%
    }

    .container {
        width: 100%;
        height: 100%
    }

    .content {
        background: rgba(135, 196, 240, 0.8);
        width: 200px;
        height: 100px;
        border: 2px #fff solid;
        padding: 10px;
        color: #fff
    }

    .content input {
        color: #bbb
    }

    .content a {
        color: #fff;
        float: right;
        margin-right: 15px
    }
</style>
<link rel="stylesheet" href="src/maptalks.css">
<script type="text/javascript" src="src/maptalks.js"></script>

<body>
    <div id="map" class="container"></div>
</body>
<script>
    var map = new maptalks.Map('map', {
        center: [-0.113049, 51.498568],
        zoom: 14,
        baseLayer: new maptalks.TileLayer('base', {
            // urlTemplate: 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
            urlTemplate: 'src/images/control/20.jpg',
            subdomains: ['a', 'b', 'c'],
            attribution: '&copy; <a href="http://www.osm.org" target="_blank">OpenStreetMap</a> contributors'
        })
    });

    var customPanel = new maptalks.control.Panel({
        'position': { "right": 426, "top": 0 },
        'draggable': true,
        'custom': true,
        'closeButton': true,
        'content': '<div class="content">' +
            'A custom panel.<br>' +
            '<input type="text" height=10 value="a text input"/><br>' +
            '<br><a href="javascript:;" onclick="hide()">close</a>' +
            '</div>'
    });

    //隐藏控件
    function hide() {
        customPanel.getDOM() && customPanel.hide();
    }
    //显示控件
    function show() {
        customPanel.getDOM() && customPanel.show();
    }
    //增加控件
    function add() {
        map.addControl(customPanel);
    }
    //删除控件
    function remove() {
        // map.removeControl(customPanel);
        customPanel.remove()
    }
    //修改控件
    function diff() {

    }
    //拖拽超出界限处理
    let customPanelDragging = customPanel.addEventListener("dragging", function (ev) {
        let width = customPanel.getContainer().offsetWidth;
        let height = customPanel.getContainer().offsetHeight;
        //getContainerPoint: 当前容器右上坐标的点{x,y};  getPosition: 当前容器的相对位置{right:,top}
        let getContainerPoint = customPanel.getContainerPoint();
        let getPosition = customPanel.getPosition();
        let containerPosition = document.documentElement.clientWidth - customPanel.getContainerPoint()["x"];
        //左上
        if (getContainerPoint["x"] < width) { //224，124
            customPanel.setPosition({ "right": document.documentElement.clientWidth - width, "top": getPosition["top"] })
            if (getContainerPoint["y"] < 0) {
                customPanel.setPosition({ "right": document.documentElement.clientWidth - width, "top": 0 })
                return;
            }
            //右下
        } else if (getContainerPoint["x"] > document.documentElement.clientWidth) {
            customPanel.setPosition({ "right": 0, "top": getPosition["top"] })
            console.log(getContainerPoint["y"], document.documentElement.clientHeight)
            if (getContainerPoint["y"] > document.documentElement.clientHeight - height) {
                customPanel.setPosition({ "right": 0, "top": document.documentElement.clientHeight - height })
                return;
            }
        };
        //右上
        if (getContainerPoint["y"] < 0) {
            customPanel.setPosition({ "top": 0, "right": getPosition["right"] })
            if (getContainerPoint["x"] > document.documentElement.clientWidth) {
                customPanel.setPosition({ "top": 0, "right": 0 })
                return;
            }
            //左下
        } else if (getContainerPoint["y"] > document.documentElement.clientHeight - height) {
            customPanel.setPosition({ "top": document.documentElement.clientHeight - height, "right": getPosition["right"] })
            if (getContainerPoint["x"] < width) {
                customPanel.setPosition({ "top": document.documentElement.clientHeight - height, "right": document.documentElement.clientWidth - width })
                return;
            }
        };

    })

    //工具条
    new maptalks.control.Toolbar({
        'position': 'top-left',
        'items': [{
            item: '显示',
            click: function () {
                show()
            }
        }, {
            item: '隐藏',
            click: function () {
                hide()
            }
        }, {
            item: '删除',
            click: function () {
                //移除控件        
                remove()
            }
        },
        {
            item: '添加',
            click: function () {
                //添加控件        
                add();
            }
        }, {
            item: '修改',
            click: function () { console.log("修改"); }
        },]
    })
        .addTo(map);
</script>

</html>